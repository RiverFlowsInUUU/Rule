function main(config) {
  // -------------------------------
  // 第一部分：规则插入
  // -------------------------------

  // 自动获取第一个代理组的名字
  const targetGroup = config["proxy-groups"]?.[0]?.name;

  if (!targetGroup) {
    console.warn("警告：未找到第一个代理组，请检查配置！");
  }

  // 确保 rules 存在
  if (!Array.isArray(config.rules)) {
    config.rules = [];
  }

  // 在规则列表最前面插入两条规则
  config.rules.unshift(
    `DOMAIN-SUFFIX,copilot.microsoft.com,${targetGroup}`,
    `DOMAIN,copilot.microsoft.com,${targetGroup}`
  );

  // -------------------------------
  // 第二部分：自动测速分组
  // -------------------------------

  // 收集所有节点名称
  const allProxyNames = (config.proxies || []).map(p => p.name);

  // 过滤出名称中包含 "0.1" 或 "0.01" 的节点
  const fastProxies = allProxyNames.filter(name => {
    return name.includes('0.1') || name.includes('0.01');
  });

  // 构造新的自动测速代理组
  const fastGroup = {
    name: '0.1-fast',
    type: 'url-test',
    proxies: fastProxies,
    url: 'http://www.gstatic.com/generate_204',
    interval: 600,
    tolerance: 50
  };

  // 确保 proxy-groups 存在
  if (!Array.isArray(config['proxy-groups'])) {
    config['proxy-groups'] = [];
  }

  const groups = config['proxy-groups'];

  // 如果没有代理组，创建一个默认入口组
  if (groups.length === 0) {
    groups.push({
      name: '入口',
      type: 'select',
      proxies: []
    });
  }

  // 把 fastGroup 插入到第二个位置（索引 1）
  groups.splice(1, 0, fastGroup);

  // 把 0.1-fast 加进第一个代理组的子代理中
  const firstGroup = groups[0];
  if (firstGroup) {
    if (!Array.isArray(firstGroup.proxies)) {
      firstGroup.proxies = [];
    }
    if (!firstGroup.proxies.includes('0.1-fast')) {
      firstGroup.proxies.push('0.1-fast');
    }
  }

  // -------------------------------
  // 返回修改后的配置
  // -------------------------------
  return config;
}
