function main(config) {
  // ===============================
  // 0. åˆå§‹åŒ–é˜²å¾¡
  // ===============================
  if (!Array.isArray(config.proxies)) config.proxies = [];
  if (!Array.isArray(config["proxy-groups"])) config["proxy-groups"] = [];
  if (!Array.isArray(config.rules)) config.rules = [];

  // ===============================
  // 1. è‡ªåŠ¨è·å–ç¬¬ä¸€ä¸ªä»£ç†ç»„ï¼ˆä¾›æµ‹é€Ÿç»„æ³¨å…¥ä½¿ç”¨ï¼‰
  // ===============================
  const firstGroup = config["proxy-groups"][0];
  const firstGroupName = firstGroup?.name;

  if (!firstGroupName) {
    console.warn("âš ï¸ æœªæ‰¾åˆ°ç¬¬ä¸€ä¸ªä»£ç†ç»„ï¼Œéƒ¨åˆ†è‡ªåŠ¨æ³¨å…¥é€»è¾‘å°†è·³è¿‡");
  }

  // ===============================
  // 2. æ”¶é›†æ‰€æœ‰ä»£ç†èŠ‚ç‚¹ï¼ˆå« providerï¼‰
  // ===============================
  const allProxies = config.proxies.map(p => p.name);

  if (config["proxy-providers"]) {
    for (const providerName in config["proxy-providers"]) {
      allProxies.push(providerName);
    }
  }

  // ===============================
  // 3. åˆ›å»º ğŸ¤–AI ä»£ç†ç»„ï¼ˆä¸åŒ…å« DIRECTï¼‰
  // ===============================
  const aiGroupName = "ğŸ¤–AI";
  const aiGroupExists = config["proxy-groups"].some(g => g.name === aiGroupName);

  if (!aiGroupExists) {
    config["proxy-groups"].push({
      name: aiGroupName,
      type: "select",
      proxies: [...allProxies]
    });
  }

  // ===============================
  // 4. AI åŸŸåè§„åˆ™ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ â†’ ğŸ¤–AIï¼‰
  // ===============================
  const aiRules = [
    // Augment
    "DOMAIN-SUFFIX,augment.com",
    "DOMAIN-SUFFIX,augmentcode.com",

    // OpenAI / ChatGPT
    "DOMAIN-SUFFIX,ai.com",
    "DOMAIN-SUFFIX,chatgpt.com",
    "DOMAIN-SUFFIX,openai.com",
    "DOMAIN,chat.openai.com.cdn.cloudflare.net",
    "DOMAIN,openaiapi-site.azureedge.net",
    "DOMAIN,openaicom-api-bdcpf8c6d2e9atf6.z01.azurefd.net",
    "DOMAIN,openaicomproductionae4b.blob.core.windows.net",
    "DOMAIN,production-openaicom-storage.azureedge.net",
    "DOMAIN-SUFFIX,cdn.oaistatic.com",
    "DOMAIN-SUFFIX,oaiusercontent.com",
    "DOMAIN,o33249.ingest.sentry.io",

    // Claude
    "DOMAIN-SUFFIX,anthropic.com",
    "DOMAIN-SUFFIX,claude.ai",
    "DOMAIN-SUFFIX,claudeusercontent.com",

    // Google AI / Gemini / NotebookLM
    "DOMAIN-KEYWORD,alkalimakersuite-pa.clients6.google.com",
    "DOMAIN-SUFFIX,aistudio.google.com",
    "DOMAIN-SUFFIX,makersuite.google.com",
    "DOMAIN-SUFFIX,generativeai.google",
    "DOMAIN,ai.google.dev",
    "DOMAIN,alkalicore-pa.clients6.google.com",
    "DOMAIN,waa-pa.clients6.google.com",
    "DOMAIN-SUFFIX,deepmind.com",
    "DOMAIN-SUFFIX,deepmind.google",
    "DOMAIN-SUFFIX,generativelanguage.googleapis.com",
    "DOMAIN-SUFFIX,geller-pa.googleapis.com",
    "DOMAIN-SUFFIX,proactivebackend-pa.googleapis.com",
    "DOMAIN-SUFFIX,aisandbox-pa.googleapis.com",
    "DOMAIN-SUFFIX,apis.google.com",
    "DOMAIN-SUFFIX,bard.google.com",
    "DOMAIN-SUFFIX,gemini.google.com",
    "DOMAIN-SUFFIX,robinfrontend-pa.googleapis.com",
    "DOMAIN-SUFFIX,notebooklm.google",
    "DOMAIN-SUFFIX,notebooklm.google.com",

    // Copilot / GitHubï¼ˆç°åœ¨ç»Ÿä¸€èµ° ğŸ¤–AIï¼Œä¸å†å¼ºåˆ¶ä¸»ä»£ç†ï¼‰
    "DOMAIN-SUFFIX,githubcopilot.com",
    "DOMAIN-SUFFIX,microsoftonline.com",
    "DOMAIN,api.github.com",    
  "DOMAIN,copilot.microsoft.com",
      "DOMAIN,app-analytics-services.com",
    // Cursor / IDE
    "DOMAIN-SUFFIX,cursor.sh",
    "DOMAIN-SUFFIX,diabrowser.engineering",
    "DOMAIN-SUFFIX,dify.ai",
    "DOMAIN-SUFFIX,jetbrains.ai",

    // Others
    "DOMAIN-SUFFIX,meta.ai",
    "DOMAIN-SUFFIX,openrouter.ai",
    "DOMAIN-SUFFIX,perplexity.ai",
    "DOMAIN-SUFFIX,poe.com",
    "DOMAIN-SUFFIX,x.ai",
    "DOMAIN-SUFFIX,grok.com",
    "DOMAIN-SUFFIX,groq.com",
    "DOMAIN-SUFFIX,sora.com",
    "DOMAIN,sora-cdn.oaistatic.com",
    "DOMAIN-SUFFIX,windsurf.com",
    "DOMAIN-SUFFIX,codeium.com",
    "DOMAIN-SUFFIX,codeiumdata.com",
    "DOMAIN-SUFFIX,zed.dev"
  ];

  const aiRuleLines = aiRules.map(r => `${r},${aiGroupName}`);
  config.rules = [...aiRuleLines, ...config.rules];

  // ===============================
  // 5. è‡ªåŠ¨æµ‹é€Ÿåˆ†ç»„ ğŸ’§ MAXï¼ˆ0.1 / 0.01ï¼Œä¸å« DIRECTï¼‰
  // ===============================
  const fastProxies = allProxies.filter(name =>
    name.includes("0.1") || name.includes("0.01")
  );

  if (fastProxies.length > 0) {
    const fastGroupName = "ğŸ’§ MAX";

    const fastGroupExists = config["proxy-groups"].some(
      g => g.name === fastGroupName
    );

    if (!fastGroupExists) {
      const fastGroup = {
        name: fastGroupName,
        type: "url-test",
        proxies: fastProxies,
        url: "http://www.gstatic.com/generate_204",
        interval: 600,
        tolerance: 50
      };

      // æ’å…¥åˆ°ç¬¬äºŒä¸ªä»£ç†ç»„
      config["proxy-groups"].splice(1, 0, fastGroup);
    }

    // æ³¨å…¥ç¬¬ä¸€ä¸ªä»£ç†ç»„ä½œä¸ºé¦–é€‰
    if (firstGroup) {
      if (!Array.isArray(firstGroup.proxies)) {
        firstGroup.proxies = [];
      }

      firstGroup.proxies = firstGroup.proxies.filter(p => p !== fastGroupName);
      firstGroup.proxies.unshift(fastGroupName);
    }
  }

  // ===============================
  // 6. åˆ›å»º ğŸµ YouTube Music ä»£ç†ç»„ï¼ˆselect / ä¸å« DIRECTï¼‰
  // ===============================
  const ytMusicGroupName = "ğŸµ YouTube Music";
  const ytMusicGroupExists = config["proxy-groups"].some(
    g => g.name === ytMusicGroupName
  );

  if (!ytMusicGroupExists) {
    config["proxy-groups"].push({
      name: ytMusicGroupName,
      type: "select",
      proxies: [...allProxies]
    });
  }

  // ===============================
  // 7. è¿”å›æœ€ç»ˆé…ç½®
  // ===============================
  return config;
}
