function main(config) {
  // ===============================
  // 0. åˆå§‹åŒ–é˜²å¾¡
  // ===============================
  if (!Array.isArray(config.proxies)) config.proxies = [];
  if (!Array.isArray(config["proxy-groups"])) config["proxy-groups"] = [];
  if (!Array.isArray(config.rules)) config.rules = [];

  // ===============================
  // 1. è‡ªåŠ¨è·å–ç¬¬ä¸€ä¸ªä»£ç†ç»„
  // ===============================
  const firstGroup = config["proxy-groups"][0];
  const firstGroupName = firstGroup?.name;

  if (!firstGroupName) {
    console.warn("âš ï¸ æœªæ‰¾åˆ°ç¬¬ä¸€ä¸ªä»£ç†ç»„ï¼ŒCopilot è§„åˆ™å¯èƒ½æ— æ•ˆ");
  }

  // ===============================
  // 2. Copilot è§„åˆ™ï¼ˆæ’å…¥æœ€å‰ï¼‰
  // ===============================
  if (firstGroupName) {
    config.rules.unshift(
      `DOMAIN-SUFFIX,copilot.microsoft.com,${firstGroupName}`,
      `DOMAIN,copilot.microsoft.com,${firstGroupName}`
    );
  }

  // ===============================
  // 3. æ”¶é›†æ‰€æœ‰ä»£ç†èŠ‚ç‚¹ï¼ˆå« providerï¼‰
  // ===============================
  const allProxies = config.proxies.map(p => p.name);

  if (config["proxy-providers"]) {
    for (const providerName in config["proxy-providers"]) {
      allProxies.push(providerName);
    }
  }

  // ===============================
  // 4. åˆ›å»º ğŸ¤–AI ä»£ç†ç»„ï¼ˆè¿½åŠ åˆ°æœ€åï¼‰
  // ===============================
  const aiGroupName = "ğŸ¤–AI";
  const aiGroupExists = config["proxy-groups"].some(g => g.name === aiGroupName);

  if (!aiGroupExists) {
    config["proxy-groups"].push({
      name: aiGroupName,
      type: "select",
      proxies: ["DIRECT", ...allProxies]
    });
  }

  // ===============================
  // 5. AI åŸŸåè§„åˆ™ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
  // ===============================
  const aiRules = [
    // Augment
    "DOMAIN-SUFFIX,augment.com",
    "DOMAIN-SUFFIX,augmentcode.com",

    // OpenAI / ChatGPT
    "DOMAIN-SUFFIX,ai.com",
    "DOMAIN-SUFFIX,chatgpt.com",
    "DOMAIN-SUFFIX,openai.com",
    "DOMAIN,chat.openai.com.cdn.cloudflare.net",
    "DOMAIN,openaiapi-site.azureedge.net",
    "DOMAIN,openaicom-api-bdcpf8c6d2e9atf6.z01.azurefd.net",
    "DOMAIN,openaicomproductionae4b.blob.core.windows.net",
    "DOMAIN,production-openaicom-storage.azureedge.net",
    "DOMAIN-SUFFIX,cdn.oaistatic.com",
    "DOMAIN-SUFFIX,oaiusercontent.com",
    "DOMAIN,o33249.ingest.sentry.io",

    // Claude
    "DOMAIN-SUFFIX,anthropic.com",
    "DOMAIN-SUFFIX,claude.ai",
    "DOMAIN-SUFFIX,claudeusercontent.com",

    // Google AI / Gemini / NotebookLM
    "DOMAIN-KEYWORD,alkalimakersuite-pa.clients6.google.com",
    "DOMAIN-SUFFIX,aistudio.google.com",
    "DOMAIN-SUFFIX,makersuite.google.com",
    "DOMAIN-SUFFIX,generativeai.google",
    "DOMAIN,ai.google.dev",
    "DOMAIN,alkalicore-pa.clients6.google.com",
    "DOMAIN,waa-pa.clients6.google.com",
    "DOMAIN-SUFFIX,deepmind.com",
    "DOMAIN-SUFFIX,deepmind.google",
    "DOMAIN-SUFFIX,generativelanguage.googleapis.com",
    "DOMAIN-SUFFIX,geller-pa.googleapis.com",
    "DOMAIN-SUFFIX,proactivebackend-pa.googleapis.com",
    "DOMAIN-SUFFIX,aisandbox-pa.googleapis.com",
    "DOMAIN-SUFFIX,apis.google.com",
    "DOMAIN-SUFFIX,bard.google.com",
    "DOMAIN-SUFFIX,gemini.google.com",
    "DOMAIN-SUFFIX,robinfrontend-pa.googleapis.com",
    "DOMAIN-SUFFIX,notebooklm.google",
    "DOMAIN-SUFFIX,notebooklm.google.com",

    // Copilot / GitHub
    "DOMAIN-SUFFIX,githubcopilot.com",
    "DOMAIN-SUFFIX,microsoftonline.com",
    "DOMAIN,api.github.com",

    // Cursor / IDE
    "DOMAIN-SUFFIX,cursor.sh",
    "DOMAIN-SUFFIX,diabrowser.engineering",
    "DOMAIN-SUFFIX,dify.ai",
    "DOMAIN-SUFFIX,jetbrains.ai",

    // Others
    "DOMAIN-SUFFIX,meta.ai",
    "DOMAIN-SUFFIX,openrouter.ai",
    "DOMAIN-SUFFIX,perplexity.ai",
    "DOMAIN-SUFFIX,poe.com",
    "DOMAIN-SUFFIX,x.ai",
    "DOMAIN-SUFFIX,grok.com",
    "DOMAIN-SUFFIX,groq.com",
    "DOMAIN-SUFFIX,sora.com",
    "DOMAIN,sora-cdn.oaistatic.com",
    "DOMAIN-SUFFIX,windsurf.com",
    "DOMAIN-SUFFIX,codeium.com",
    "DOMAIN-SUFFIX,codeiumdata.com",
    "DOMAIN-SUFFIX,zed.dev"
  ];

  const aiRuleLines = aiRules.map(r => `${r},${aiGroupName}`);
  config.rules = [...aiRuleLines, ...config.rules];

  // ===============================
  // 6. è‡ªåŠ¨æµ‹é€Ÿåˆ†ç»„ 0.1-fast
  // ===============================
  const fastProxies = allProxies.filter(name =>
    name.includes("0.1") || name.includes("0.01")
  );

  if (fastProxies.length > 0) {
    const fastGroupName = "0.1-fast";

    const fastGroupExists = config["proxy-groups"].some(
      g => g.name === fastGroupName
    );

    if (!fastGroupExists) {
      const fastGroup = {
        name: fastGroupName,
        type: "url-test",
        proxies: fastProxies,
        url: "http://www.gstatic.com/generate_204",
        interval: 600,
        tolerance: 50
      };

      // æ’å…¥åˆ°ç¬¬äºŒä¸ªä½ç½®
      config["proxy-groups"].splice(1, 0, fastGroup);

      // æ³¨å…¥ç¬¬ä¸€ä¸ªä»£ç†ç»„
      if (firstGroup) {
        if (!Array.isArray(firstGroup.proxies)) {
          firstGroup.proxies = [];
        }
        if (!firstGroup.proxies.includes(fastGroupName)) {
          firstGroup.proxies.push(fastGroupName);
        }
      }
    }
  }

  // ===============================
  // 7. è¿”å›æœ€ç»ˆé…ç½®
  // ===============================
  return config;
}
